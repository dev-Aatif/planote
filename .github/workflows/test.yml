name: Unit Tests

on:
  push:
    branches: [ main, master, dev ]
  pull_request:
    branches: [ main, master, dev ]

jobs:
  build-test:
    name: "Build & Test"
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Install Flatpak and SDK
        run: |
          sudo apt-get update
          sudo apt-get install -y flatpak flatpak-builder
          sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
          sudo flatpak remote-add --if-not-exists gnome-nightly https://nightly.gnome.org/gnome-nightly.flatpakrepo
          sudo flatpak install -y gnome-nightly org.gnome.Sdk//49 org.gnome.Platform//49
      
      - name: Build with flatpak-builder
        run: |
          flatpak-builder --force-clean --stop-at=planote _build build-aux/io.github.dev_aatif.planote.Devel.json
      
      - name: Show build success
        run: echo "Build completed successfully!"
